(()=>{"use strict";var t={208:(t,e,n)=>{n.d(e,{A:()=>g});var r=n(601),i=n.n(r),o=n(314),s=n.n(o),a=n(417),l=n.n(a),c=new URL(n(985),n.b),h=new URL(n(462),n.b),d=new URL(n(211),n.b),u=s()(i()),p=l()(c),f=l()(h),m=l()(d);u.push([t.id,`@font-face {\n  font-family: "Poster Army";\n  src: url(${p});\n}\n\n*, *::before, *::after {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n}\n\nbody {\n  --light-blue: rgb(140, 195, 221);\n  --light-blue-emphasis: rgb(175, 226, 247);\n\n  --header-height: 5rem;\n  --footer-height: 2rem;\n  --main-height: calc(100vh - var(--header-height) - var(--footer-height));\n  --board-size: min(80vw, calc((var(--main-height) * 0.5) - 3rem));\n\n  --default-font: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n\n  font-family: var(--default-font, sans-serif);\n  color: #d1e7dd;\n  background-color: #214070;\n  height: 100vh;\n  text-align: center;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: stretch;\n  align-items: stretch;\n}\n\n.hidden {\n  display: none !important;\n}\n\n/* Header */\n\nheader {\n  height: var(--header-height);\n\n  display: flex;\n  flex-direction: row;\n  justify-content: space-around;\n}\n\nheader h1 {\n  --title-height: calc(var(--header-height) - 20px);\n\n  font-family: "Poster Army", Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;\n  margin: 10px;\n  font-size: min(5vw, var(--title-height));\n  line-height: var(--title-height);\n  font-weight: normal;\n  text-transform: uppercase;\n}\n\nheader #message {\n  margin: 8px;\n  padding: 5px 10px;\n  width: 36rem;\n  font-family: 'Courier New', Courier, monospace;\n  color: #181a1d;\n  background-color: var(--light-blue, lightblue);\n}\n\n/* Main */\n\nmain {\n  flex: 1;\n  max-height: var(--main-height);\n\n  display: flex;\n  flex-direction: column;\n  justify-content: space-around;\n  align-items: center;\n}\n\nmain section {\n  display: flex;\n  flex-direction: column;\n  gap: 7px;\n}\n\nmain section .board {\n  width: var(--board-size);\n}\n\n/* Player Ships section */\n\nsection#player {\n  padding: 10px;\n}\n\nsection#player #placement-action-bar {\n  padding: 0.5rem;\n}\n\n#placement-action-bar button {\n  font-family: var(--default-font, sans-serif);\n  font-size: 1rem;\n  font-weight: bold;\n\n  margin: 3px;\n  padding: 3px 7px;\n\n  background-color: var(--light-blue, lightblue);\n  border: 2px solid var(--light-blue-emphasis);\n  border-radius: 7px;\n\n  cursor: pointer;\n}\n\n#placement-action-bar button:hover {\n  background-color: var(--light-blue-emphasis);\n}\n\nsection#player .board {\n  --grid-border-color: #193258;\n  background-color: #124d9b;\n  border: 3px solid var(--grid-border-color);\n  margin: auto;\n  display: grid;\n  /* Grid columns and rows are defined dynamically. */\n}\n\nsection#player .board .cell {\n  border: 1px solid var(--grid-border-color);\n  cursor: pointer;\n}\n\nsection#player .board.locked .cell {\n  cursor: default;\n}\n\nsection#player .board .cell.ship {\n  background-color: #97a899;\n}\n\nsection#player .board .cell.hit {\n  background: url(${f}), #97a899;\n}\n\nsection#player .board .cell.miss {\n  background: url(${m});\n}\n\n/* Attacks on Opponent section */\n\nsection#opponent {\n  --grid-border-color: #8b8983;\n  color: #323130;\n  background: #eeedec;\n  padding: 20px;\n  padding-top: 15px;\n}\n\nsection#opponent .board {\n  border: 2px solid var(--grid-border-color, gray);\n  margin: auto;\n\n  display: grid;\n  /* Grid columns and rows are defined dynamically. */\n}\n\nsection#opponent .board.locked, section#opponent .board.locked .cell {\n  cursor: wait !important;\n}\n\nsection#opponent .board .cell {\n  border: 1px solid var(--grid-border-color, gray);\n  cursor: pointer;\n}\n\nsection#opponent .board .cell.hit {\n  background: url(${f});\n  cursor: default;\n}\n\nsection#opponent .board .cell.miss {\n  background: url(${m});\n  cursor: default;\n}\n\n/* Footer */\n\nfooter a {\n  height: var(--footer-height);\n  line-height: var(--footer-height);\n  color: #ddeebb;\n}\n\nfooter a:hover {\n  color: #eeffcc;\n}\n\n/* Wide screen adjustments*/\n\n@media (orientation: landscape) {\n  main {\n    --board-size: min(40vw, calc(var(--main-height) - 5rem));\n    flex-direction: row-reverse;\n  }\n\n  section#opponent {\n    padding-bottom: 35px;\n  }\n}`,""]);const g=u},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<t.length;c++){var h=[].concat(t[c]);r&&s[h[0]]||(void 0!==o&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=o),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),e.push(h))}},e}},417:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},601:t=>{t.exports=function(t){return t[1]}},72:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var o={},s=[],a=0;a<t.length;a++){var l=t[a],c=r.base?l[0]+r.base:l[0],h=o[c]||0,d="".concat(c," ").concat(h);o[c]=h+1;var u=n(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)e[u].references++,e[u].updater(p);else{var f=i(p,r);r.byIndex=a,e.splice(a,0,{identifier:d,updater:f,references:1})}s.push(d)}return s}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var o=r(t=t||[],i=i||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var a=n(o[s]);e[a].references--}for(var l=r(t,i),c=0;c<o.length;c++){var h=n(o[c]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}o=l}}},659:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},985:(t,e,n)=>{t.exports=n.p+"00eedb3a7245d07720ed.otf"},462:(t,e,n)=>{t.exports=n.p+"5ffb59eab1a3bdef0ce4.svg"},211:(t,e,n)=>{t.exports=n.p+"275ca5f206153b6bfe5d.svg"}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={id:r,exports:{}};return t[r](o,o.exports,n),o.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=r[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.b=document.baseURI||self.location.href,n.nc=void 0;var r=n(72),i=n.n(r),o=n(825),s=n.n(o),a=n(659),l=n.n(a),c=n(56),h=n.n(c),d=n(540),u=n.n(d),p=n(113),f=n.n(p),m=n(208),g={};g.styleTagTransform=f(),g.setAttributes=h(),g.insert=l().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=u(),i()(m.A,g),m.A&&m.A.locals&&m.A.locals;class b{constructor(){this._observers=[]}subscribe(t){this._observers.push(t)}unsubscribe(t){this._observers=this._observers.filter((e=>e!==t))}unsubscribeAll(){this._observers=[]}notifyChanged(t={}){t.sender??=this,this._observers.forEach((e=>e(t)))}}const y=-1,v=function(t){return!!t&&(t.startsWith("v")||t.startsWith("V"))};class _{constructor(t){this._length=t,this._hitCount=0,this._isVertical=!1,this._x=y,this._y=y}get length(){return this._length}get height(){return this.isVertical()?this.length:1}get hitCount(){return this._hitCount}get orientation(){return this.isVertical()?"vertical":"horizontal"}set orientation(t){if(this.isPlaced())throw new Error("Cannot rotate a ship that is already placed");v(t)?this._isVertical=!0:this._isVertical=!1}get width(){return this.isVertical()?1:this.length}get x(){return this._x}get y(){return this._y}getPlacedCoordinates(){return this.getPlacedCoordinatesFrom(this.x,this.y,this.orientation)}getPlacedCoordinatesFrom(t,e,n=this.orientation){let r=v(n);if(t==y||e==y)return[];let i=[];if(r)for(let n=0;n<this.length;n++)i.push({x:t,y:e+n});else for(let n=0;n<this.length;n++)i.push({x:t+n,y:e});return i}hit(){this._hitCount+=1}isHorizontal(){return!this.isVertical()}isPlaced(){return this.x>=0}isSunk(){return this._hitCount>=this._length}isVertical(){return this._isVertical}place(t,e,n=null){this.remove(),null!==n&&(this.orientation=n),this._x=t,this._y=e}remove(){this._x=y,this._y=y}rotate(){this.isVertical()?this.orientation="horizontal":this.orientation="vertical"}}class k extends b{constructor(t,e){super(),this._width=t,this._height=e,this._ships=[],this._shipGrid=new Array(t*e),this._attackGrid=new Array(t*e)}get ships(){return[...this._ships]}get sunkShips(){return this._ships.filter((t=>t.isSunk()))}get survivingShips(){return this._ships.filter((t=>!t.isSunk()))}get width(){return this._width}get height(){return this._height}areAllShipsSunk(){return this._ships.length>0&&this._ships.every((t=>t.isSunk()))}isInBounds(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}shipAt(t,e){return this.isInBounds(t,e)?this._shipGrid[this._indexAt(t,e)]??null:null}hasShipAt(t,e){return!!this.shipAt(t,e)}canPlace(t,e,n,r=this.orientation){if(!this.isInBounds(e,n))return!1;if(v(r)){if(!this.isInBounds(e,n+t.length-1))return!1}else if(!this.isInBounds(e+t.length-1,n))return!1;const i=t.getPlacedCoordinatesFrom(e,n,r);for(const{x:e,y:n}of i){let r=this.shipAt(e,n);if(r&&r!==t)return!1}return!0}canPlaceHorizontal(t,e,n){return this.canPlace(t,e,n,"horizontal")}canPlaceVertical(t,e,n){return this.canPlace(t,e,n,"vertical")}place(t,e,n,r){if(this._ships.includes(t)&&this.remove(t),!this.canPlace(t,e,n,r))throw new Error(`No room for ${r} length ${t.length} ship placement at ${e},${n}`);t.place(e,n,r);for(const{x:e,y:n}of t.getPlacedCoordinates())this._shipGrid[this._indexAt(e,n)]=t,this.notifyChanged({ship:t,x:e,y:n,action:"place"});this._ships.push(t)}placeHorizontal(t,e,n){return this.place(t,e,n,"horizontal")}placeVertical(t,e,n){return this.place(t,e,n,"vertical")}remove(t){let e=this._ships.indexOf(t);if(e>=0){this._ships.splice(e,1);for(const{x:e,y:n}of t.getPlacedCoordinates())delete this._shipGrid[this._indexAt(e,n)],this.notifyChanged({ship:t,x:e,y:n,action:"remove"});return t.remove(),!0}return!1}canBeAttacked(t,e){return this.isInBounds(t,e)&&!this.hasBeenAttacked(t,e)}hasBeenAttacked(t,e){return!!this._attackGrid[this._indexAt(t,e)]}receiveAttack(t,e){if(!this.canBeAttacked(t,e))throw new Error(`Can't attack ${t},${e}`);this._attackGrid[this._indexAt(t,e)]=!0;const n=this.shipAt(t,e);let r;return n?(n.hit(),r="hit"):r="miss",this.notifyChanged({x:t,y:e,ship:n,action:"receiveAttack",result:r}),{x:t,y:e,hitShip:n}}_indexAt(t,e){return Number.parseInt(e)*this.width+Number.parseInt(t)}}const x=[5,4,3,3,2];class C extends b{constructor({name:t="Player",opponent:e=null,placementAI:n=null,attackAI:r=null,boardWidth:i=10,boardHeight:o=10,shipSpecs:s=x}={}){super(),this._placementAI=n,this._attackAI=r,this._board=new k(i,o),this._board.subscribe(this._onBoardChange.bind(this)),this._ownedShips=s.map((t=>new _(t))),this.name=t,this.opponent=e}get board(){return this._board}get name(){return this._name}set name(t){this._name=t,this.notifyChanged({property:"name"})}get opponent(){return this._opponent}set opponent(t){this._opponent=t,t&&(t._opponent=this),this.notifyChanged({property:"opponent"})}get shipsToPlace(){return this._ownedShips.filter((t=>!t.isPlaced()))}get placedShips(){return this._board.ships}isComputer(){return!!this._attackAI}isHuman(){return!this.isComputer()}autoPlaceShips(){return!!this._placementAI&&(this.removeAllShips(),this._placementAI.placeAllShips(this),!0)}areAllShipsPlaced(){return this._board.ships.length==this._ownedShips.length}canPlace(t,e,n,r){return this._board.canPlace(t,e,n,r)}canPlaceHorizontal(t,e,n){return this._board.canPlaceHorizontal(t,e,n)}canPlaceVertical(t,e,n){return this._board.canPlaceVertical(t,e,n)}place(t,e,n,r){if(!this._ownedShips.includes(t))throw new Error("That's not this player's ship!");this._board.place(t,e,n,r)}placeHorizontal(t,e,n){this.place(t,e,n,"horizontal")}placeVertical(t,e,n){this.place(t,e,n,"vertical")}remove(t){this.board.remove(t)}removeAllShips(){let t=this.placedShips;for(const e of t)this.remove(e)}canAttack(t,e){return!!this.opponent&&this.opponent.board.canBeAttacked(t,e)}attack(t,e){if(!this.canAttack(t,e))throw new Error(`Player can't attack ${t},${e}`);let n=this.opponent.board.receiveAttack(t,e);return this.notifyChanged({action:"attack",x:t,y:e,ship:n.hitShip,result:n.hitShip?"hit":"miss"}),n}autoAttack(){return this._attackAI?this._attackAI.attackAs(this):null}wins(){return this.opponent.loses()}loses(){return this.board.areAllShipsSunk()}_onBoardChange(t){const e=Object.assign({},t,{sender:this,property:"board"});this.notifyChanged(e)}}class A{constructor(t=Math.random){this._randomFraction=t}placeAllShips(t){for(const e of t.shipsToPlace){let n=!1;for(;!n;)n=this._tryPlaceShip(t,e)}}_randomBoolean(){return this._randomFraction()>=.5}_randomIndex(t){return Math.floor(this._randomFraction()*t)}_tryPlaceShip(t,e){let n,r,i,o;this._randomBoolean()?(n=t.placeHorizontal,r=t.canPlaceHorizontal,i=e.length,o=1):(n=t.placeVertical,r=t.canPlaceVertical,i=1,o=e.length);let s=this._randomIndex(1+t.board.width-i),a=this._randomIndex(1+t.board.height-o);return!!r.call(t,e,s,a)&&(n.call(t,e,s,a),!0)}}class w{constructor(t=Math.random){this._randomFraction=t}attackAs(t){const e=t.opponent.board.width,n=t.opponent.board.height;let r=-1,i=-1;for(;!t.canAttack(r,i);)r=Math.floor(this._randomFraction()*e),i=Math.floor(this._randomFraction()*n);return t.attack(r,i)}}class P{constructor(t){this._containerNode=t,this._containerNode.addEventListener("click",this._onClick.bind(this))}bindPlayer(t){this._player&&this._player.unsubscribe(this._onPlayerChange.bind(this)),this._player=t,this._player.subscribe(this._onPlayerChange.bind(this)),this._setupStyle(),this._setupCells()}get columnCount(){return this._player?this._player.board.width:0}get rowCount(){return this._player?this._player.board.height:0}cellNodeAtCoords(t,e){return document.getElementById(this.idAtCoords(t,e))}coordsAtId(t){const[e,n,r]=t.split(",");return{x:Number.parseInt(n),y:Number.parseInt(r)}}idAtCoords(t,e){return`${this._containerNode.id},${t},${e}`}setCellClickListener(t){this._onCellClick=t}setCellChangeListener(t){this._onCellChange=t}lock(){this._containerNode.classList.add("locked"),this._locked=!0}unlock(){this._locked=!1,this._containerNode.classList.remove("locked")}_onPlayerChange(t){if(this._onCellChange){let e=this.cellNodeAtCoords(t.x,t.y);this._onCellChange(e,t)}}_onClick(t){if(this._onCellClick&&!this._locked&&t.target.classList.contains("cell")){let e=Object.assign({},this.coordsAtId(t.target.id),{player:this._player});this._onCellClick(t.target,e)}}_setupStyle(){const t=this.columnCount/this.rowCount;this._containerNode.style.setProperty("aspect-ratio",t),this._containerNode.style.setProperty("grid-template-columns",`repeat(${this.columnCount}, 1fr)`),this._containerNode.style.setProperty("grid-template-rows",`repeat(${this.rowCount}, 1fr)`)}_setupCells(){this._containerNode.replaceChildren();for(let t=0;t<this.rowCount;t++)for(let e=0;e<this.columnCount;e++){let n=document.createElement("div");n.classList.add("cell"),n.id=this.idAtCoords(e,t),this._onCellChange&&this._onCellChange(n,{sender:this._player,action:"bind",x:e,y:t}),this._containerNode.appendChild(n)}}}const S=function(){let t=null,e=null,n=null,r=!1,i=!1;const o=new P(document.getElementById("player-board"));o.setCellChangeListener((function(t,e){s(t,e.x,e.y)})),o.setCellClickListener((function(e,{x:i,y:o}){if(!n)return;const s=r?"vertical":"horizontal";if(t.canPlace(n,i,o,s)){const e=n;n=null,t.place(e,i,o,s)}else L.setErrorMessage(`Can't place this ship at ${i},${o}! Try somewhere else.`)}));const s=function(t,n,r){e.hasShipAt(n,r)?(t.classList.add("ship"),t.classList.remove("miss"),e.hasBeenAttacked(n,r)?t.classList.add("hit"):t.classList.remove("hit")):(t.classList.remove("ship"),t.classList.remove("hit"),e.hasBeenAttacked(n,r)?t.classList.add("miss"):t.classList.remove("miss"))};return{bindPlayer:function(n){t=n,e=n.board,o.bindPlayer(n)},holdShip:function(t){r=!1,n=t},getHeldShip:function(){return n},releaseShip:function(t){r=!1,n=t},rotate:function(){if(i)return;r=!r;const t=r?"vertically":"horizontally";L.setMessage(`To place your ${n.length}-cell ship ${t}, click where its top end will go. Use the R key to rotate.`)},lock:function(){i=!0,o.lock()},unlock:function(){i=!1,o.unlock()}}}(),I=function(){let t=null,e=null;const n=new P(document.getElementById("opponent-board"));n.setCellChangeListener((function(t,e){i(t,e.x,e.y)})),n.setCellClickListener((function(e,n){t.canAttack(n.x,n.y)&&(r(),t.attack(n.x,n.y))}));const r=function(){n.lock()},i=function(t,n,r){t.classList.remove("hit"),t.classList.remove("miss"),e.hasBeenAttacked(n,r)&&(e.hasShipAt(n,r)?(console.log("hit at",n,r),t.classList.add("hit")):(console.log("miss at",n,r),t.classList.add("miss")))};return{bindPlayer:function(r){t=r.opponent,e=r.board,n.bindPlayer(r)},lock:r,unlock:function(){n.unlock()}}}(),L=function(){const t=document.getElementById("message"),e=document.getElementById("placement-action-bar"),n=document.getElementById("placement-randomize-button"),r=document.getElementById("placement-clear-button"),i=document.getElementById("placement-done-button"),o=document.getElementById("opponent");let s=null,a=null,l=null;const c=function(e){t.classList.remove("error"),t.innerText=e},h=function(e){t.classList.add("error"),t.innerText=e},d=function(){let t=s.shipsToPlace;if(0==t.length)S.releaseShip(),c("All your ships are placed. Click Done to start the attack phase.");else{let e=t[0];S.holdShip(e),c(`Your next ship is ${e.length} cells long.Click to place its left end. Use the R key to rotate.`)}},u=function(){return s.areAllShipsPlaced()},p=function(){return u()?(S.lock(),e.classList.add("hidden"),I.unlock(),o.classList.remove("hidden"),l=s,c("Make your move."),!0):(h("Please place all your ships first."),!1)},f=function(){l.wins()?c(`${l.name} wins!`):(l=l.opponent,l.isHuman()?I.unlock():setTimeout((()=>l.autoAttack()),1600))},m=function(t){if("place"==t.action||"remove"==t.action)S.getHeldShip()||d();else if("attack"==t.action){let{sender:e,x:n,y:r,ship:i}=t,o="hit"==t.result?"hit":"missed",s=`${e.name} ${o} ${e.opponent.name} at ${n},${r}`;i&&i.isSunk()&&(s+=`. ${e.name} sank ${e.opponent.name}'s ship!`),c(s),f()}};return{setMessage:c,setErrorMessage:h,startNewGame:function(){s=new C({name:"Player 1",placementAI:new A}),s.subscribe(m.bind(this)),S.bindPlayer(s),a=new C({name:"CPU",placementAI:new A,attackAI:new w,opponent:s}),a.autoPlaceShips(),a.subscribe(m.bind(this)),I.bindPlayer(a),I.lock(),S.lock(),n.addEventListener("click",(function(){s.autoPlaceShips(),d()})),r.addEventListener("click",(function(){s.removeAllShips(),d()})),i.addEventListener("click",(function(){p()})),document.addEventListener("keypress",(function(t){"r"==t.key&&S.rotate()})),S.unlock(),d()},startNextPlacementStep:d,canStartAttackPhase:u,startAttackPhase:p,startNextTurn:f}}();L.startNewGame()})();